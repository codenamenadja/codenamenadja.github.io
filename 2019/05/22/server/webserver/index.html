<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>ec2에서 nginx uwsgi로 장고앱 세팅 | Junehan&#39;s workbook</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="webserver  웹서버가 하는 일은 사용자가 네트워크를 통해 요청을 보내면, 요청에 대한 해석과 응답을 돌려주는 역할. 요청을 해석할때, 어떤 리소스를 찾느냐에 대한 처리를 진행, WAS와 통신하요 사용자 요텅을 해성하는 어플에 대한 호출과 콜백을 처리   APACHE  메인 쓰레드가 있고, 하위에 워커등의 방식으로 서브 프로레스를 만들어서 다량의 요">
<meta name="keywords" content="nginx,django">
<meta property="og:type" content="article">
<meta property="og:title" content="ec2에서 nginx uwsgi로 장고앱 세팅">
<meta property="og:url" content="https://codenamenadja.github.io/2019/05/22/server/webserver/index.html">
<meta property="og:site_name" content="Junehan&#39;s workbook">
<meta property="og:description" content="webserver  웹서버가 하는 일은 사용자가 네트워크를 통해 요청을 보내면, 요청에 대한 해석과 응답을 돌려주는 역할. 요청을 해석할때, 어떤 리소스를 찾느냐에 대한 처리를 진행, WAS와 통신하요 사용자 요텅을 해성하는 어플에 대한 호출과 콜백을 처리   APACHE  메인 쓰레드가 있고, 하위에 워커등의 방식으로 서브 프로레스를 만들어서 다량의 요">
<meta property="og:locale" content="ko">
<meta property="og:updated_time" content="2021-01-25T08:36:06.087Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ec2에서 nginx uwsgi로 장고앱 세팅">
<meta name="twitter:description" content="webserver  웹서버가 하는 일은 사용자가 네트워크를 통해 요청을 보내면, 요청에 대한 해석과 응답을 돌려주는 역할. 요청을 해석할때, 어떤 리소스를 찾느냐에 대한 처리를 진행, WAS와 통신하요 사용자 요텅을 해성하는 어플에 대한 호출과 콜백을 처리   APACHE  메인 쓰레드가 있고, 하위에 워커등의 방식으로 서브 프로레스를 만들어서 다량의 요">
  
    <link rel="alternate" href="/atom.xml" title="Junehan&#39;s workbook" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Junehan&#39;s workbook</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">work flow and descriptions</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="검색"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://codenamenadja.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-server/webserver" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/05/22/server/webserver/" class="article-date">
  <time datetime="2019-05-22T01:17:35.000Z" itemprop="datePublished">2019-05-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      ec2에서 nginx uwsgi로 장고앱 세팅
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="webserver"><a class="markdownIt-Anchor" href="#webserver"></a> webserver</h2>
<ul>
<li>웹서버가 하는 일은 사용자가 네트워크를 통해 요청을 보내면, 요청에 대한 해석과 응답을 돌려주는 역할. 요청을 해석할때, 어떤 리소스를 찾느냐에 대한 처리를 진행, WAS와 통신하요 사용자 요텅을 해성하는 어플에 대한 호출과 콜백을 처리</li>
</ul>
<ol>
<li>APACHE
<ul>
<li>메인 쓰레드가 있고, 하위에 워커등의 방식으로 서브 프로레스를 만들어서 다량의 요청을 처리</li>
</ul>
</li>
<li>NGINX
<ul>
<li>이벤트 처리방식, 요청이 들어오면 어플리케이션에 요청처리를 부탁하고 본인은 계속 들어온 요청에 대한 대응을 수행한다. Apache에 비해서 적은 리소스를 사용하고 빠른 처리가 가능</li>
</ul>
</li>
</ol>
<h2 id="nginx설치"><a class="markdownIt-Anchor" href="#nginx설치"></a> nginx설치</h2>
<ol>
<li><code>sudo apt install nginx</code></li>
<li><code>service nginx status</code> or <code>systemctl status nginx</code></li>
<li><code>ec2-52-78-46-217.ap-northeast-2.compute.amazonaws.com:80</code> 웹 브라우저 동작 테스트</li>
<li>설정파일로 프로그램 설정</li>
<li><code>sudo cp /etc/nginx/site-available/default /etc/nginx/sites-available</code></li>
<li><code>vim /etc/nginx/site-available/staticweb</code></li>
</ol>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">server 80;</span><br><span class="line">listen [::]:80;</span><br><span class="line"></span><br><span class="line">root /var/www/staticweb;</span><br><span class="line"></span><br><span class="line">server_name ec2-52-78-46-217.ap-northeast-2.compute.amazonaws.com; #EC2 인스턴스의 퍼블릭 인스턴스 DNS</span><br><span class="line"></span><br><span class="line">location / &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre>
<ol>
<li>설정파일을 제대로 했다면, Nginx를 재시작 해여한다.</li>
<li>설정파일이 올바른지 확인하는 법</li>
</ol>
<pre><code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$:sudo nginx -t</span><br><span class="line"><span class="built_in">test</span> is successful</span><br></pre></td></tr></table></figure>
</code></pre>
<ol>
<li>해당 설정파일을 Nginx로 연결시켜야 한다. sudo ln -s /etc/nginx/sites-available/staticweb /etc/nginx/sites-enabled/</li>
<li>test</li>
<li><code>sudo vim etc/nginx/nginx.conf</code></li>
</ol>
<pre><code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">24 server_name_hash_size 128</span><br></pre></td></tr></table></figure>
</code></pre>
<ol>
<li>고정 IP가 필요한 이유는 도메인 연결을 하기 위해서</li>
<li>route53에서 ip주소에 따른 주소 생성하고</li>
<li>IP를 바인딩 하는 순간 기존 퍼블릭 도메인네임 으로 접속하는 것은 끝남</li>
<li><code>ssh -i ~/.ssh/aws-ec2-junehan.pen ubuntu@52.78.68.43</code></li>
<li>서비스 한번 리스타트 해주고</li>
<li>접속이 잘 된다</li>
<li>staticweb의 servername을 route53에 매칭한 주소로 바꿔준다.</li>
</ol>
<h2 id="백업-재활용을-위한-이미지-생성"><a class="markdownIt-Anchor" href="#백업-재활용을-위한-이미지-생성"></a> 백업, 재활용을 위한 이미지 생성</h2>
<ol>
<li>인스턴스 탭에서 이미지 생성</li>
<li>images AMIs에 있음</li>
</ol>
<h2 id="웹서버가-웹-어플을-관리하기-위한-계정-생성"><a class="markdownIt-Anchor" href="#웹서버가-웹-어플을-관리하기-위한-계정-생성"></a> 웹서버가 웹 어플을 관리하기 위한 계정 생성</h2>
<ol>
<li>
<p><code>sudo useradd -g www-data -b /home -m -s /bin/bash django</code></p>
<ul>
<li>www-data: nginx설치시 생성된 그룹</li>
<li><code>-b</code> : 루트 디렉터리(유저의 홈폴터</li>
<li><code>-m</code> : 자신의 계정 명의</li>
<li><code>-s</code> : 로그인 기본쉘</li>
</ul>
</li>
<li>
<p><code>sudo mkdir -p /var/www/django</code></p>
</li>
<li>
<p><code>sudo chown django:www-data /var/www/django</code></p>
</li>
<li>
<p><code>sudo usermod -a -G www-data ubuntu</code> 루트권한 유저 그룹 변경</p>
<ul>
<li>a :add</li>
<li>G :group</li>
</ul>
</li>
<li>
<p><code>sudo chmod g+w /var/www/django</code></p>
</li>
<li>
<p>python <a href="http://manage.py" target="_blank" rel="noopener">manage.py</a> runserver 0:8000</p>
</li>
<li>
<p>제대로 출력되지 않으면 ALLOWED_HOST 설정 += ‘*’</p>
</li>
<li>
<p>80번 포트에 nginx가 req를 받으면, uwsgi를 통해서 8000번 포트로 인계하라는 명령을?</p>
</li>
<li>
<p><code>pip install uwsgi</code></p>
<ul>
<li>nginx랑 uwsgi 붙어 있는가?</li>
<li>uwsgi랑 django랑 잘 붙어 있는가?</li>
</ul>
</li>
<li>
<p><code>uwsgi --http :8000 --home /var/www/django/venv/ --chdir /var/www/django/ --module config.uwsgi</code></p>
<ul>
<li>uwsgi는 run을 통해 소켓 파일을 생성한다.</li>
</ul>
</li>
<li>
<p><code>mkdir run logs</code></p>
</li>
<li>
<p><code>chown django:</code></p>
</li>
<li>
<p>uwsgi의 실행 프로세스 자동화, 컴퓨터 재시작시 자동 시작 프로세스에 등록하기, 그 시작에 해당 자동화 설정을 포함하기</p>
</li>
<li>
<p>mkdir</p>
</li>
<li>
<p>uswgi.ini</p>
<ul>
<li>vacuum = true : 원래 만들어져 있던 파일을 지운다.</li>
<li>uswgi.ini외에도 [Service]의 ExecStart에서는 폴더를 기준으로 실행하기 때문에, 설정 파일이 복수로 있다면, 다수의 장고앱을 실행한다.</li>
</ul>
</li>
<li>
<p>staticweb 일때만 root가 필요하다i.</p>
</li>
</ol>
<h2 id="흐름-정리"><a class="markdownIt-Anchor" href="#흐름-정리"></a> 흐름 정리</h2>
<ol>
<li>nginx&lt;-&gt;uwsgi site-available/django <code>restart nginx</code></li>
<li>uWSGI uwsgi.service <code>systemctl deamon-reload</code>, <code>restart uwsgi</code></li>
<li>uWSGI &lt;-&gt; djnago uwsgi.ini or django code diff? <code>uwsgi restart</code></li>
</ol>
<h2 id="step-24-장고-소스코드가-있는-폴더의-소유자와-권한을-변경"><a class="markdownIt-Anchor" href="#step-24-장고-소스코드가-있는-폴더의-소유자와-권한을-변경"></a> step 24. 장고 소스코드가 있는 폴더의 소유자와 권한을 변경</h2>
<p><code>sudo chown -R django:www-data /var/www/django</code><br>
<code>sudo chmod -R g+w /var/www/django</code></p>
<h2 id="위지윅-에디터"><a class="markdownIt-Anchor" href="#위지윅-에디터"></a> 위지윅 에디터</h2>
<ul>
<li>자바스크립트 라이브러리를 가지고 설정</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://codenamenadja.github.io/2019/05/22/server/webserver/" data-id="ckkdb52ft000j1pqk7ougtmwi" class="article-share-link">공유</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/django/">django</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nginx/">nginx</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/05/27/python/custom_module/using_sqs/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">최신</strong>
      <div class="article-nav-title">
        
          boto3로 sqs자원 사용하기
        
      </div>
    </a>
  
  
    <a href="/2019/05/20/python/library/django/server_basic/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">이전</strong>
      <div class="article-nav-title">server and client</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">태그</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/c/">c</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/custom-module/">custom module</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/django/">django</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fabric/">fabric</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/functional-programming/">functional programming</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo-deploy/">hexo-deploy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/">http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/network/">network</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pipenv/">pipenv</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/postgresql/">postgresql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/project/">project</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python-module/">python module</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python-post/">python post</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sql/">sql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/testing/">testing</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/travel-note/">travel_note</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tutorial/">tutorial</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">태그 클라우드</h3>
    <div class="widget tagcloud">
      <a href="/tags/c/" style="font-size: 11.43px;">c</a> <a href="/tags/custom-module/" style="font-size: 12.86px;">custom module</a> <a href="/tags/django/" style="font-size: 14.29px;">django</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/fabric/" style="font-size: 10px;">fabric</a> <a href="/tags/functional-programming/" style="font-size: 11.43px;">functional programming</a> <a href="/tags/hexo-deploy/" style="font-size: 10px;">hexo-deploy</a> <a href="/tags/http/" style="font-size: 11.43px;">http</a> <a href="/tags/linux/" style="font-size: 15.71px;">linux</a> <a href="/tags/network/" style="font-size: 11.43px;">network</a> <a href="/tags/nginx/" style="font-size: 10px;">nginx</a> <a href="/tags/pipenv/" style="font-size: 10px;">pipenv</a> <a href="/tags/postgresql/" style="font-size: 10px;">postgresql</a> <a href="/tags/project/" style="font-size: 10px;">project</a> <a href="/tags/python/" style="font-size: 20px;">python</a> <a href="/tags/python-module/" style="font-size: 17.14px;">python module</a> <a href="/tags/python-post/" style="font-size: 18.57px;">python post</a> <a href="/tags/sql/" style="font-size: 10px;">sql</a> <a href="/tags/testing/" style="font-size: 10px;">testing</a> <a href="/tags/travel-note/" style="font-size: 10px;">travel_note</a> <a href="/tags/tutorial/" style="font-size: 10px;">tutorial</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">아카이브</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">1월 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">9월 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">8월 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">7월 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">6월 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">5월 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">최근 포스트</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/01/26/fastcamp/my_post/">test_post</a>
          </li>
        
          <li>
            <a href="/2019/09/17/http/2_http_sementics/">http_1.0_sementics</a>
          </li>
        
          <li>
            <a href="/2019/09/09/project/travel_note/">travel_note 서비스 고찰</a>
          </li>
        
          <li>
            <a href="/2019/09/06/http/1_http_1.0_basic_four_feature/">http/1.0의 신택스: 기본이 되는 네가지 요소</a>
          </li>
        
          <li>
            <a href="/2019/09/05/python/post/async_coroutine_5/">비동기 코루틴 번역-5-End</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 junehan<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>